<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="800" height="600" viewBox="0 0 800 600">
  <!-- 定义样式 -->
  <defs>
    <style type="text/css">
      .service { fill: #E1F5FE; stroke: #0288D1; stroke-width: 2; }
      .event-bus { fill: #FFF9C4; stroke: #FBC02D; stroke-width: 2; }
      .database { fill: #E8F5E9; stroke: #388E3C; stroke-width: 2; }
      .arrow { stroke: #616161; stroke-width: 2; marker-end: url(#arrowhead); }
      .event { fill: #F3E5F5; stroke: #8E24AA; stroke-width: 2; }
      .text { font-family: Arial; font-size: 14px; fill: #212121; }
      .title { font-family: Arial; font-size: 18px; font-weight: bold; fill: #212121; }
      .subtitle { font-family: Arial; font-size: 14px; font-style: italic; fill: #616161; }
    </style>
    
    <!-- 箭头标记 -->
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#616161" />
    </marker>
  </defs>
  
  <!-- 标题 -->
  <text x="400" y="30" class="title" text-anchor="middle">微服务系统中的事件驱动通信</text>
  <text x="400" y="55" class="subtitle" text-anchor="middle">Event-Driven Communication in Microservices</text>
  
  <!-- 事件总线 -->
  <rect x="300" y="150" width="200" height="60" rx="10" ry="10" class="event-bus" />
  <text x="400" y="185" class="text" text-anchor="middle">事件总线 (Event Bus)</text>
  
  <!-- 微服务 -->
  <rect x="100" y="300" width="120" height="60" rx="10" ry="10" class="service" />
  <text x="160" y="335" class="text" text-anchor="middle">用户服务</text>
  
  <rect x="250" y="300" width="120" height="60" rx="10" ry="10" class="service" />
  <text x="310" y="335" class="text" text-anchor="middle">订单服务</text>
  
  <rect x="400" y="300" width="120" height="60" rx="10" ry="10" class="service" />
  <text x="460" y="335" class="text" text-anchor="middle">支付服务</text>
  
  <rect x="550" y="300" width="120" height="60" rx="10" ry="10" class="service" />
  <text x="610" y="335" class="text" text-anchor="middle">库存服务</text>
  
  <!-- 事件存储 -->
  <rect x="300" y="450" width="200" height="60" rx="10" ry="10" class="database" />
  <text x="400" y="485" class="text" text-anchor="middle">事件存储 (Event Store)</text>
  
  <!-- 连接线 - 发布事件 -->
  <line x1="160" y1="300" x2="320" y2="210" class="arrow" />
  <text x="200" y="240" class="text" text-anchor="middle">发布事件</text>
  
  <line x1="310" y1="300" x2="370" y2="210" class="arrow" />
  <text x="320" y="240" class="text" text-anchor="middle">发布事件</text>
  
  <line x1="460" y1="300" x2="400" y2="210" class="arrow" />
  <text x="450" y="240" class="text" text-anchor="middle">发布事件</text>
  
  <line x1="610" y1="300" x2="450" y2="210" class="arrow" />
  <text x="550" y="240" class="text" text-anchor="middle">发布事件</text>
  
  <!-- 连接线 - 订阅事件 -->
  <line x1="340" y1="210" x2="180" y2="300" class="arrow" />
  <text x="230" y="270" class="text" text-anchor="middle">订阅事件</text>
  
  <line x1="380" y1="210" x2="330" y2="300" class="arrow" />
  <text x="340" y="270" class="text" text-anchor="middle">订阅事件</text>
  
  <line x1="420" y1="210" x2="480" y2="300" class="arrow" />
  <text x="430" y="270" class="text" text-anchor="middle">订阅事件</text>
  
  <line x1="460" y1="210" x2="590" y2="300" class="arrow" />
  <text x="540" y="270" class="text" text-anchor="middle">订阅事件</text>
  
  <!-- 连接线 - 事件存储 -->
  <line x1="400" y1="210" x2="400" y2="450" class="arrow" />
  <text x="420" y="350" class="text" text-anchor="middle">持久化</text>
  
  <!-- 事件示例 -->
  <ellipse cx="150" y="120" rx="80" ry="30" class="event" />
  <text x="150" y="125" class="text" text-anchor="middle">UserCreatedEvent</text>
  <line x1="150" y1="150" x2="300" y2="170" class="arrow" />
  
  <ellipse cx="300" y="100" rx="80" ry="30" class="event" />
  <text x="300" y="105" class="text" text-anchor="middle">OrderPlacedEvent</text>
  <line x1="300" y1="130" x2="350" y2="150" class="arrow" />
  
  <ellipse cx="500" y="100" rx="80" ry="30" class="event" />
  <text x="500" y="105" class="text" text-anchor="middle">PaymentProcessedEvent</text>
  <line x1="500" y1="130" x2="450" y2="150" class="arrow" />
  
  <ellipse cx="650" y="120" rx="80" ry="30" class="event" />
  <text x="650" y="125" class="text" text-anchor="middle">InventoryUpdatedEvent</text>
  <line x1="650" y1="150" x2="500" y2="170" class="arrow" />
  
  <!-- 事件处理流程 -->
  <rect x="50" y="520" width="700" height="60" rx="10" ry="10" fill="#ECEFF1" stroke="#607D8B" stroke-width="2" />
  <text x="400" y="545" class="text" text-anchor="middle">事件流：用户下单 → 创建订单 → 支付处理 → 库存更新 → 订单确认</text>
  <line x1="100" y1="520" x2="150" y2="500" class="arrow" />
  <line x1="250" y1="520" x2="300" y2="500" class="arrow" />
  <line x1="450" y1="520" x2="450" y2="500" class="arrow" />
  <line x1="600" y1="520" x2="600" y2="500" class="arrow" />
</svg>